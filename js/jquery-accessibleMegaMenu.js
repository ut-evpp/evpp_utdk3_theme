!function(y,T,u){"use strict";var D,l,E,I,s,a,o,r,c,f,h,d,p,i,k,b,n="accessibleMegaMenu",m={uuidPrefix:"accessible-megamenu",menuClass:"accessible-megamenu",topNavItemClass:"accessible-megamenu-top-nav-item",panelClass:"accessible-megamenu-panel",panelGroupClass:"accessible-megamenu-panel-group",hoverClass:"hover",focusClass:"focus",openClass:"open",openDelay:0,closeDelay:250},N={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,keyMap:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",190:"."}};function P(e,t){this.element=e,this.settings=y.extend({},m,t),this._defaults=m,this._name=n,this.mouseTimeoutID=null,this.focusTimeoutID=null,this.mouseFocused=!1,this.justFocused=!1,this.init()}function g(e){return y.expr.filters.visible(e)&&!y(e).parents().addBack().filter(function(){return"hidden"===y.css(this,"visibility")}).length}function C(e,t){var s,a,i,n=e.nodeName.toLowerCase();return"area"===n?(a=(s=e.parentNode).name,!(!e.href||!a||"map"!==s.nodeName.toLowerCase())&&(!!(i=y("img[usemap=#"+a+"]")[0])&&g(i))):(/input|select|textarea|button|object/.test(n)?!e.disabled:"a"===n&&e.href||t)&&g(e)}P.prototype=(i=0,k="",b="function"==typeof T.hasOwnProperty&&!!T.hasOwnProperty("ontouchstart"),D=function(e){return y(e).closest(":data(plugin_"+n+")").data("plugin_"+n)},l=function(e){e=y(e);var t=this.settings;e.attr("id")||e.attr("id",t.uuidPrefix+"-"+(new Date).getTime()+"-"+ ++i)},E=function(e,t){var s,a=y(e.target),i=this,n=this.settings,l=this.menu,o=a.closest("."+n.topNavItemClass),r=a.hasClass(n.panelClass)?a:a.closest("."+n.panelClass);if(p.call(this,!0),t)if((o=l.find("."+n.topNavItemClass+" ."+n.openClass+":first").closest("."+n.topNavItemClass)).is(e.relatedTarget)||0<o.has(e.relatedTarget).length)0===o.length&&l.find("[aria-expanded=true]").attr("aria-expanded","false").removeClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","true");else{if(("mouseout"===e.type||"focusout"===e.type)&&0<o.has(u.activeElement).length)return;o.find("[aria-expanded]").attr("aria-expanded","false").removeClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","true"),("keydown"===e.type&&e.keyCode===N.ESCAPE||"DOMAttrModified"===e.type)&&(s=o.find(":tabbable:first"),setTimeout(function(){l.find("[aria-expanded]."+i.settings.panelClass).off("DOMAttrModified.accessible-megamenu"),s.focus(),i.justFocused=!1},99))}else clearTimeout(i.focusTimeoutID),o.siblings().find("[aria-expanded]").attr("aria-expanded","false").removeClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","true"),o.find("[aria-expanded]").attr("aria-expanded","true").addClass(n.openClass).filter("."+n.panelClass).attr("aria-hidden","false"),"mouseover"===e.type&&a.is(":tabbable")&&1===o.length&&0===r.length&&0<l.has(u.activeElement).length&&(a.focus(),i.justFocused=!1),p.call(i)},I=function(e){var t=y(e.target).closest(":tabbable"),s=t.closest("."+this.settings.topNavItemClass),a=t.closest("."+this.settings.panelClass);1===s.length&&0===a.length&&1===s.find("."+this.settings.panelClass).length&&(t.hasClass(this.settings.openClass)?this.justFocused?(e.preventDefault(),e.stopPropagation(),this.justFocused=!1):b&&(e.preventDefault(),e.stopPropagation(),E.call(this,e,t.hasClass(this.settings.openClass))):(e.preventDefault(),e.stopPropagation(),E.call(this,e),this.justFocused=!1))},s=function(e){0===y(e.target).closest(this.menu).length&&(e.preventDefault(),e.stopPropagation(),E.call(this,e,!0))},a=function(e){"aria-expanded"===e.originalEvent.attrName&&"false"===e.originalEvent.newValue&&y(e.target).hasClass(this.settings.openClass)&&(e.preventDefault(),e.stopPropagation(),E.call(this,e,!0))},o=function(e){clearTimeout(this.focusTimeoutID);var t=y(e.target),s=t.closest("."+this.settings.panelClass);t.addClass(this.settings.focusClass).on("click.accessible-megamenu",y.proxy(I,this)),this.justFocused=!this.mouseFocused,this.mouseFocused=!1,this.panels.not(s).filter("."+this.settings.openClass).length&&E.call(this,e)},r=function(t){this.justFocused=!1;var s=this,e=y(t.target),a=e.closest("."+this.settings.topNavItemClass);e.removeClass(this.settings.focusClass).off("click.accessible-megamenu"),T.cvox?s.focusTimeoutID=setTimeout(function(){T.cvox.Api.getCurrentNode(function(e){a.has(e).length?clearTimeout(s.focusTimeoutID):s.focusTimeoutID=setTimeout(function(e,t,s){E.call(e,t,s)},275,s,t,!0)})},25):s.focusTimeoutID=setTimeout(function(){E.call(s,t,!0)},300)},c=function(e){var t,s,a,i,n,l,o=this.constructor===P?this:D(this),r=o.settings,u=y(y(this).is("."+r.hoverClass+":tabbable")?this:e.target),c=o.menu,f=o.topnavitems,h=u.closest("."+r.topNavItemClass),d=c.find(":tabbable"),p=u.hasClass(r.panelClass)?u:u.closest("."+r.panelClass),b=p.find("."+r.panelGroupClass),m=u.closest("."+r.panelGroupClass),g=e.keyCode||e.which,C=!1,v=N.keyMap[e.keyCode]||"",x=1===h.length&&0===p.length;if(!u.is("input:focus, select:focus, textarea:focus, button:focus")){switch(u.is("."+r.hoverClass+":tabbable")&&y("html").off("keydown.accessible-megamenu"),g){case N.ESCAPE:E.call(o,e,!0);break;case N.DOWN:e.preventDefault(),!(C=x?(E.call(o,e),1===h.find("."+r.panelClass+" :tabbable:first").focus().length):1===d.filter(":gt("+d.index(u)+"):first").focus().length)&&T.opera&&"[object Opera]"===opera.toString()&&(e.ctrlKey||e.metaKey)&&(a=(d=y(":tabbable")).index(u),C=1===y(":tabbable:gt("+y(":tabbable").index(u)+"):first").focus().length);break;case N.UP:e.preventDefault(),x&&u.hasClass(r.openClass)?(E.call(o,e,!0),(t=f.filter(":lt("+f.index(h)+"):last")).children("."+r.panelClass).length&&(C=1===t.children().attr("aria-expanded","true").addClass(r.openClass).filter("."+r.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):x||(C=1===d.filter(":lt("+d.index(u)+"):last").focus().length),!C&&T.opera&&"[object Opera]"===opera.toString()&&(e.ctrlKey||e.metaKey)&&(a=(d=y(":tabbable")).index(u),C=1===y(":tabbable:lt("+y(":tabbable").index(u)+"):first").focus().length);break;case N.RIGHT:e.preventDefault(),x?C=1===f.filter(":gt("+f.index(h)+"):first").find(":tabbable:first").focus().length:(b.length&&m.length&&(C=1===b.filter(":gt("+b.index(m)+"):first").find(":tabbable:first").focus().length),C||(C=1===h.find(":tabbable:first").focus().length));break;case N.LEFT:e.preventDefault(),x?C=1===f.filter(":lt("+f.index(h)+"):last").find(":tabbable:first").focus().length:(b.length&&m.length&&(C=1===b.filter(":lt("+b.index(m)+"):last").find(":tabbable:first").focus().length),C||(C=1===h.find(":tabbable:first").focus().length));break;case N.TAB:a=d.index(u),e.shiftKey&&x&&u.hasClass(r.openClass)?(E.call(o,e,!0),(t=f.filter(":lt("+f.index(h)+"):last")).children("."+r.panelClass).length&&(C=t.children().attr("aria-expanded","true").addClass(r.openClass).filter("."+r.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):e.shiftKey&&0<a?C=1===d.filter(":lt("+a+"):last").focus().length:!e.shiftKey&&a<d.length-1?C=1===d.filter(":gt("+a+"):first").focus().length:T.opera&&"[object Opera]"===opera.toString()&&(a=(d=y(":tabbable")).index(u),C=e.shiftKey?1===y(":tabbable:lt("+y(":tabbable").index(u)+"):last").focus().length:1===y(":tabbable:gt("+y(":tabbable").index(u)+"):first").focus().length),C&&e.preventDefault();break;case N.SPACE:if(!x)return!0;e.preventDefault(),I.call(o,e);break;case N.ENTER:return!0;default:if(clearTimeout(this.keydownTimeoutID),0===(k+=v!==k?v:"").length)return;for(this.keydownTimeoutID=setTimeout(function(){k=""},1e3),d=x&&!u.hasClass(r.openClass)?d.filter(":not(."+r.panelClass+" :tabbable)"):h.find(":tabbable"),e.shiftKey&&(d=y(d.get().reverse())),a=0;a<d.length;a++)if((i=d.eq(a)).is(u)){s=1===k.length?a+1:a;break}for(l=new RegExp("^"+k.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),"i"),a=s;a<d.length;a++)if(i=d.eq(a),n=y.trim(i.text()),l.test(n)){C=!0,i.focus();break}if(!C)for(a=0;a<s;a++)if(i=d.eq(a),n=y.trim(i.text()),l.test(n)){i.focus();break}}o.justFocused=!1}},f=function(e){(y(e.target).is(this.settings.panelClass)||y(e.target).closest(":focusable").length)&&(this.mouseFocused=!0),clearTimeout(this.mouseTimeoutID),this.mouseTimeoutID=setTimeout(function(){clearTimeout(this.focusTimeoutID)},1)},h=function(e){clearTimeout(this.mouseTimeoutID);var t=this;this.mouseTimeoutID=setTimeout(function(){y(e.target).addClass(t.settings.hoverClass),E.call(t,e),y(e.target).is(":tabbable")&&y("html").on("keydown.accessible-megamenu",y.proxy(c,e.target))},this.settings.openDelay)},d=function(e){clearTimeout(this.mouseTimeoutID);var t=this;y(e.target).removeClass(t.settings.hoverClass),t.mouseTimeoutID=setTimeout(function(){E.call(t,e,!0)},this.settings.closeDelay),y(e.target).is(":tabbable")&&y("html").off("keydown.accessible-megamenu")},p=function(e){var t=this.menu;e?(y("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu"),t.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu")):(y("html").on("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",y.proxy(s,this)),t.find("[aria-expanded=true]."+this.settings.panelClass).on("DOMAttrModified.accessible-megamenu",y.proxy(a,this)))},{constructor:P,init:function(){var e=this.settings,t=y(this.element),s=t.children().first(),a=s.children();this.start(e,t,s,a)},start:function(i,e,t,s){var n=this;this.settings=i,this.menu=t,this.topnavitems=s,e.attr("role","navigation"),t.addClass(i.menuClass),s.each(function(e,t){var s,a;(t=y(t)).addClass(i.topNavItemClass),s=t.find(":tabbable:first"),a=t.children(":not(:tabbable):last"),l.call(n,s),a.length&&(l.call(n,a),s.attr({"aria-controls":a.attr("id"),"aria-expanded":!1}),a.attr({role:"region","aria-expanded":!1,"aria-hidden":!0}).addClass(i.panelClass).not("[aria-labelledby]").attr("aria-labelledby",s.attr("id")))}),this.panels=t.find("."+i.panelClass),t.on("focusin.accessible-megamenu",":focusable, ."+i.panelClass,y.proxy(o,this)).on("focusout.accessible-megamenu",":focusable, ."+i.panelClass,y.proxy(r,this)).on("keydown.accessible-megamenu",y.proxy(c,this)).on("mouseover.accessible-megamenu",y.proxy(h,this)).on("mouseout.accessible-megamenu",y.proxy(d,this)).on("mousedown.accessible-megamenu",y.proxy(f,this)),b&&t.on("touchstart.accessible-megamenu",y.proxy(I,this)),t.find("hr").attr("role","separator"),y(u.activeElement).closest(t).length&&y(u.activeElement).trigger("focusin.accessible-megamenu")},getDefaults:function(){return this._defaults},getOption:function(e){return this.settings[e]},getAllOptions:function(){return this.settings},setOption:function(e,t,s){this.settings[e]=t,s&&this.init()}}),y.fn[n]=function(e){return this.each(function(){y.data(this,"plugin_"+n)||y.data(this,"plugin_"+n,new y.fn[n].AccessibleMegaMenu(this,e))})},y.fn[n].AccessibleMegaMenu=P,y.extend(y.expr[":"],{data:y.expr.createPseudo?y.expr.createPseudo(function(t){return function(e){return!!y.data(e,t)}}):function(e,t,s){return!!y.data(e,s[3])},focusable:function(e){return C(e,!isNaN(y.attr(e,"tabindex")))},tabbable:function(e){var t=y.attr(e,"tabindex"),s=isNaN(t);return(s||0<=t)&&C(e,!s)}})}(jQuery,window,document);